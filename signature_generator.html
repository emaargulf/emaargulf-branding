<!-- 
    Project: Emaar Gulf Signature Generator
    Version: 5.0 (Ultimate Edition)
    Developer: Mohammed Safdar (archengsafdar@gmail.com)
    Features: Intelligent Formatting, Self-Healing Storage, Crash Protection, Enterprise Typography
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="archengsafdar@gmail.com">
    <meta name="description" content="Official Email Signature Generator for Emaar Gulf Engineering Consultants.">
    <title>Signature Generator | Emaar Gulf</title>
    
    <!-- Pinned Dependencies for Stability -->
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .preview-area { background-image: radial-gradient(#e5e7eb 1px, transparent 1px); background-size: 20px 20px; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Utility */
        .invalid-input { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col overflow-hidden">

    <!-- LOGIN SCREEN OVERLAY -->
    <div id="login-overlay" class="fixed inset-0 z-50 bg-[#333] flex flex-col items-center justify-center text-white">
        <div class="bg-white text-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md text-center fade-in border-t-4 border-[#f1aa27]">
            <!-- Resilient Logo Loading -->
            <img src="https://emaargulf.github.io/emaargulf-branding/logo-full-dark.png" class="h-16 mx-auto mb-6 object-contain" alt="Emaar Gulf" onerror="this.style.display='none'; document.getElementById('login-fallback').classList.remove('hidden');">
            <h1 id="login-fallback" class="hidden text-3xl font-bold text-[#333] mb-6 tracking-tighter">EMAAR GULF</h1>
            
            <h2 class="text-xl font-bold mb-2">Internal Signature Portal</h2>
            <p class="text-xs text-gray-500 mb-6">Please enter the access code to proceed.</p>
            
            <input type="password" id="login-pass" class="w-full p-3 border border-gray-300 rounded mb-4 text-center focus:ring-2 focus:ring-[#f1aa27] outline-none transition" placeholder="Enter Access Code">
            
            <button onclick="checkLogin()" class="w-full bg-[#f1aa27] hover:bg-yellow-500 text-gray-900 font-bold py-3 rounded transition transform active:scale-95">
                Enter Portal
            </button>
            <p id="login-error" class="text-red-500 text-xs mt-3 hidden font-bold">Incorrect Access Code</p>
        </div>
        <p class="text-xs text-gray-500 mt-8">Authorized Personnel Only | Emaar Gulf Engineering</p>
        <p class="text-[10px] text-gray-600 mt-2 opacity-50 font-mono hover:opacity-100 transition"><a href="mailto:archengsafdar@gmail.com">Dev: archengsafdar@gmail.com</a></p>
    </div>

    <!-- MAIN APP (Hidden by default) -->
    <div id="main-app" class="flex-col h-full hidden">
        
        <!-- HEADER -->
        <header class="bg-[#333] text-white p-4 flex justify-between items-center shadow-md z-10 border-b border-gray-700">
            <div class="flex items-center gap-3">
                <img src="https://emaargulf.github.io/emaargulf-branding/logo-icon-light.png" class="h-8" alt="Logo" onerror="this.style.display='none'">
                <h1 class="font-bold text-lg">Signature Generator <span class="text-xs font-normal text-gray-400 ml-2 font-mono">v5.0 Enterprise</span></h1>
            </div>
            <div class="text-xs text-gray-400 font-mono flex items-center gap-2">
                <span id="save-status" class="opacity-0 transition-opacity text-[#f1aa27] font-bold">‚úì Saved</span>
                <span class="text-gray-600">|</span>
                SECURE SESSION
            </div>
        </header>

        <div class="flex flex-1 overflow-hidden">
            
            <!-- SIDEBAR: CONTROLS -->
            <div class="w-1/3 bg-white border-r border-gray-200 overflow-y-auto flex flex-col shadow-xl z-0">
                
                <div class="p-6 space-y-6 flex-grow">
                    <!-- Section: Personal Info -->
                    <div>
                        <h3 class="text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <svg class="w-4 h-4 text-[#f1aa27]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            Employee Details
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1">Full Name (English)</label>
                                <input type="text" id="input-name-en" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] focus:border-[#f1aa27] outline-none transition uppercase placeholder-gray-300" placeholder="YOUR NAME" oninput="updateSignature()">
                                <p class="text-[10px] text-gray-400 mt-1">Auto-converts to UPPERCASE.</p>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1 font-[Cairo]">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ (Arabic)</label>
                                <input type="text" id="input-name-ar" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] focus:border-[#f1aa27] outline-none transition text-right font-[Cairo]" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿä" oninput="updateSignature()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1">Job Title / Position</label>
                                <input type="text" id="input-job" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] focus:border-[#f1aa27] outline-none transition uppercase placeholder-gray-300" placeholder="JOB TITLE | POSITION" oninput="updateSignature()">
                            </div>
                            
                            <!-- Branch Dropdown -->
                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1">Branch / Location</label>
                                <div class="relative">
                                    <select id="input-branch" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] focus:border-[#f1aa27] outline-none transition appearance-none bg-white cursor-pointer" onchange="updateSignature()">
                                        <option value="Riyadh Branch" selected>Riyadh Branch</option>
                                        <option value="Dammam Branch">Dammam Branch</option>
                                        <option value="Al Ahsa Branch">Al Ahsa Branch</option>
                                        <option value="Al Khobar Branch">Al Khobar Branch</option>
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Section: Contact Info -->
                    <div>
                        <h3 class="text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <svg class="w-4 h-4 text-[#f1aa27]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                            Contact Information
                        </h3>
                        <div class="space-y-4">
                            
                            <!-- Split Phone Input -->
                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1">Phone Number</label>
                                <div class="flex gap-2">
                                    <select id="input-country-code" class="w-1/3 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] outline-none bg-white text-sm" onchange="updateSignature()">
                                        <option value="+966" selected>üá∏üá¶ +966</option>
                                        <option value="+20">üá™üá¨ +20</option>
                                        <option value="+971">üá¶üá™ +971</option>
                                        <option value="+91">üáÆüá≥ +91</option>
                                    </select>
                                    <input type="text" id="input-phone-number" class="w-2/3 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] outline-none transition" placeholder="123 456 789" oninput="updateSignature()">
                                </div>
                                <p class="text-[10px] text-gray-400 mt-1">Smart Input: Only numbers allowed.</p>
                            </div>

                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1">Email Address</label>
                                <input type="email" id="input-email" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] focus:border-[#f1aa27] outline-none transition lowercase placeholder-gray-300" placeholder="yourmail@emaargulf.com" oninput="updateSignature()">
                                <p id="email-warning" class="text-[10px] text-red-500 mt-1 hidden">‚ö†Ô∏è Please enter a valid email address.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Section: Footer Settings -->
                    <div>
                        <h3 class="text-sm font-bold text-gray-900 uppercase tracking-wider mb-4 border-b pb-2 flex items-center gap-2">
                            <svg class="w-4 h-4 text-[#f1aa27]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            Legal & Footer
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1">Disclaimer Text</label>
                                <textarea id="input-disclaimer" rows="4" class="w-full p-2 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] outline-none transition" oninput="updateSignature()">The content of this email is confidential and intended for the recipient specified in the message only. It is strictly forbidden to share any part of this message with any third party without the written consent of the sender.</textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-500 mb-1">Eco Message</label>
                                <input type="text" id="input-eco" class="w-full p-2 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-[#f1aa27] outline-none transition" value="Please consider the environment before printing this email." oninput="updateSignature()">
                            </div>
                        </div>
                    </div>

                    <!-- Section: Admin Toggle -->
                    <div class="pt-4 mt-4 border-t border-gray-100">
                        <button onclick="toggleAdmin()" id="admin-btn" class="text-xs text-gray-400 hover:text-gray-600 flex items-center gap-1 transition-colors group">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 group-hover:text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                            Edit Company Links (Admin Only)
                        </button>

                        <!-- Hidden Admin Area -->
                        <div id="admin-panel" class="hidden mt-4 bg-gray-50 p-4 rounded-lg border border-gray-200 animate-fade-in-down">
                            <div class="flex justify-between items-center mb-3 border-b border-red-100 pb-2">
                                <h4 class="text-xs font-bold text-red-600 uppercase">Administrator Controls</h4>
                                <button onclick="resetDefaults()" class="text-[10px] text-red-400 hover:text-red-600 underline">Reset Defaults</button>
                            </div>
                            
                            <!-- Socials -->
                            <div class="space-y-3 mb-4">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Social Media Links</label>
                                <input type="text" id="link-wa" placeholder="WhatsApp Link" class="w-full text-xs p-1.5 border rounded bg-gray-100 text-gray-500" readonly title="Auto-generated from Phone Number">
                                <input type="text" id="link-ig" placeholder="Instagram Link" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                                <input type="text" id="link-fb" placeholder="Facebook Link" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                                <input type="text" id="link-sc" placeholder="Snapchat Link" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                                <input type="text" id="link-li" placeholder="LinkedIn Link" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                                <input type="text" id="link-x" placeholder="X (Twitter) Link" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                            </div>

                            <!-- Maps -->
                            <div class="space-y-3">
                                <label class="text-[10px] font-bold text-gray-400 uppercase">Google Map Links</label>
                                <input type="text" id="map-riyadh" placeholder="Riyadh Map URL" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                                <input type="text" id="map-dammam" placeholder="Dammam Map URL" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                                <input type="text" id="map-alahsa" placeholder="Al Ahsa Map URL" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                                <input type="text" id="map-alkhobar" placeholder="Al Khobar Map URL" class="w-full text-xs p-1.5 border rounded" oninput="updateAdminLinks()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FOOTER WITH AUTHOR -->
                <div class="bg-gray-100 border-t border-gray-200 p-4 text-center">
                    <p class="text-[10px] text-gray-400">
                        Engineered by <a href="mailto:archengsafdar@gmail.com" class="text-gray-500 hover:text-[#f1aa27] font-bold transition">archengsafdar@gmail.com</a>
                    </p>
                </div>

            </div>

            <!-- MAIN: PREVIEW -->
            <div class="w-2/3 flex flex-col preview-area">
                
                <!-- Toolbar -->
                <div class="bg-white border-b border-gray-200 p-3 flex justify-between items-center px-8">
                    <span class="text-sm font-medium text-gray-500">Live Preview</span>
                    <button onclick="copyFinalSignature()" class="bg-[#f1aa27] hover:bg-yellow-500 text-gray-900 px-6 py-2 rounded-lg font-bold shadow-sm transition flex items-center gap-2 transform hover:scale-105 active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>
                        Copy Signature
                    </button>
                </div>

                <!-- Canvas -->
                <div class="flex-1 flex items-center justify-center p-10 overflow-auto">
                    <div class="bg-white p-8 shadow-2xl rounded-sm border border-gray-200 scale-110 origin-top">
                        
                        <!-- HIDDEN TEMPLATE START (Copy Target) -->
                        <div id="signature-container">
                            <table width="600" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 600px; max-width: 100%; background-color: #ffffff; border-collapse: collapse; table-layout: fixed;">
                                <tr>
                                    <td style="padding: 0;">
                                        <table width="100%" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%; border-collapse: collapse;">
                                            <tr>
                                                <!-- LEFT COLUMN -->
                                                <td width="220" valign="top" style="width: 220px; border-right: 1px solid #eeeeee; padding-right: 20px; vertical-align: top;">
                                                    <table width="100%" height="250" cellpadding="0" cellspacing="0" border="0" role="presentation" style="height: 250px;">
                                                        <tr>
                                                            <td align="center" valign="top" style="padding-top: 40px; line-height: 0;">
                                                                <a href="https://www.emaargulf.com" target="_blank" style="text-decoration: none;">
                                                                    <img src="https://emaargulf.github.io/emaargulf-branding/logo-full-dark.png" alt="Emaar Gulf" width="160" style="display: block; border: 0; width: 160px; height: auto;">
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td align="center" valign="bottom" style="padding-bottom: 5px;">
                                                                <!-- SOCIAL ICONS -->
                                                                <table cellpadding="0" cellspacing="0" border="0" role="presentation" style="margin: 0 auto 10px auto;">
                                                                    <tr>
                                                                        <td style="padding: 0 3px; font-size: 0; line-height: 0;"><a id="sig-wa" href="https://wa.me/966552771352" target="_blank"><img src="https://img.icons8.com/ios/50/333333/whatsapp--v1.png" width="18" height="18" style="display: block; border:0;"></a></td>
                                                                        <td style="padding: 0 3px; font-size: 0; line-height: 0;"><a id="sig-ig" href="https://www.instagram.com/emaar_gulf/" target="_blank"><img src="https://img.icons8.com/ios/50/333333/instagram-new--v1.png" width="18" height="18" style="display: block; border:0;"></a></td>
                                                                        <td style="padding: 0 3px; font-size: 0; line-height: 0;"><a id="sig-fb" href="https://www.emaargulf.com" target="_blank"><img src="https://img.icons8.com/ios/50/333333/facebook-new.png" width="18" height="18" style="display: block; border:0;"></a></td>
                                                                        <td style="padding: 0 3px; font-size: 0; line-height: 0;"><a id="sig-sc" href="https://www.emaargulf.com" target="_blank"><img src="https://img.icons8.com/ios/50/333333/snapchat--v1.png" width="18" height="18" style="display: block; border:0;"></a></td>
                                                                        <td style="padding: 0 3px; font-size: 0; line-height: 0;"><a id="sig-li" href="https://www.linkedin.com/company/emaargulf" target="_blank"><img src="https://img.icons8.com/ios/50/333333/linkedin.png" width="18" height="18" style="display: block; border:0;"></a></td>
                                                                        <td style="padding: 0 3px; font-size: 0; line-height: 0;"><a id="sig-x" href="https://x.com/emaar_gulf" target="_blank"><img src="https://img.icons8.com/ios/50/333333/twitterx--v2.png" width="18" height="18" style="display: block; border:0;"></a></td>
                                                                    </tr>
                                                                </table>
                                                                <a href="https://www.emaargulf.com" target="_blank" style="color: #444444; text-decoration: none !important; font-size: 10px; font-weight: 700; letter-spacing: 2px; font-family: 'Inter', Arial, sans-serif; text-transform: lowercase;">
                                                                    <span style="color: #444444; text-decoration: none;">www.emaargulf.com</span>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>

                                                <!-- RIGHT COLUMN -->
                                                <td width="340" valign="top" style="width: 340px; padding-left: 20px; vertical-align: top;">
                                                    <table width="100%" height="250" cellpadding="0" cellspacing="0" border="0" role="presentation" style="width: 100%; height: 250px;">
                                                        <tr>
                                                            <td align="left" valign="top" style="padding-top: 20px; vertical-align: top;">
                                                                <!-- DYNAMIC CONTENT -->
                                                                <!-- UPDATED FONT STACK: 'Sakkal Majalla' & 'Geeza Pro' added for OS Compatibility -->
                                                                <div id="sig-name-ar" style="font-family: 'Cairo', 'Almarai', 'Sakkal Majalla', 'Geeza Pro', 'Segoe UI', Tahoma, sans-serif; font-size: 26px; font-weight: 700; color: #333333; line-height: 1.1; margin-bottom: 4px;">ŸÖÿ≠ŸÖÿØ ÿµŸÅÿØÿ±</div>
                                                                <div id="sig-name-en" style="font-family: 'Inter', Arial, sans-serif; font-size: 18px; font-weight: 700; color: #333333; letter-spacing: 0.5px; text-transform: uppercase; margin-bottom: 5px;">MOHAMMED SAFDAR</div>
                                                                <div id="sig-job" style="font-family: 'Inter', Arial, sans-serif; font-size: 11px; color: #f1aa27; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px;">Senior Architect | Technical Engineer</div>
                                                                <div id="sig-branch" style="font-family: 'Inter', Arial, sans-serif; font-size: 11px; color: #888888; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">Riyadh Branch</div>
                                                                
                                                                <div style="margin-bottom: 4px;">
                                                                    <table cellpadding="0" cellspacing="0" border="0" role="presentation">
                                                                        <tr>
                                                                            <td valign="middle" style="padding-right: 8px;"><img src="https://img.icons8.com/ios/50/333333/phone--v1.png" width="13" height="13" alt="" style="display: block;"></td>
                                                                            <td valign="middle"><a id="sig-phone-link" href="tel:+966552771352" style="font-family: 'Inter', Arial, sans-serif; font-size: 15px; color: #444444; font-weight: 700; text-decoration: none !important;"><span id="sig-phone-text" style="color: #444444;">+966 552 771 352</span></a></td>
                                                                        </tr>
                                                                    </table>
                                                                </div>
                                                                <div style="margin-bottom: 15px;">
                                                                    <table cellpadding="0" cellspacing="0" border="0" role="presentation">
                                                                        <tr>
                                                                            <td valign="middle" style="padding-right: 8px;"><img src="https://img.icons8.com/ios/50/333333/mail.png" width="13" height="13" alt="" style="display: block;"></td>
                                                                            <td valign="middle"><a id="sig-email-link" href="mailto:mohammed@emaargulf.com" style="font-family: 'Inter', Arial, sans-serif; font-size: 14px; color: #444444; text-decoration: none !important;"><span id="sig-email-text" style="color: #444444;">mohammed@emaargulf.com</span></a></td>
                                                                        </tr>
                                                                    </table>
                                                                </div>
                                                            </td>
                                                            <td align="right" valign="top" width="65" style="width: 65px; padding-top: 0; line-height: 0;">
                                                                <!-- SELF-FIXING LOGO -->
                                                                <img src="https://emaargulf.github.io/emaargulf-branding/logo-part-g.png" width="65" alt="" style="display: block; border: 0; width: 65px;" onerror="this.style.display='none'">
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="2" align="left" valign="bottom" style="padding-bottom: 5px;">
                                                                <!-- MAP LINKS (Dynamic Highlighting) -->
                                                                <div style="font-family: 'Inter', Arial, sans-serif; font-size: 10px; color: #888888; font-weight: 500; line-height: 1.4; letter-spacing: 0.5px;">
                                                                    <!-- Riyadh (Default Highlight) -->
                                                                    <a id="sig-map-riyadh" href="https://www.google.com/maps/search/?api=1&query=Emaar+Gulf+Engineering+Consultant+Riyadh" target="_blank" style="text-decoration: none !important; color: #f1aa27; font-weight: 700;"><span style="color: #f1aa27;">RIYADH</span></a>
                                                                    <span style="color: #dddddd; padding: 0 2px;">|</span>
                                                                    <a id="sig-map-dammam" href="https://www.google.com/maps/search/?api=1&query=Emaar+Gulf+Engineering+Consultant+-+Dammam" target="_blank" style="text-decoration: none !important; color: #888888; font-weight: 500;"><span style="color: #888888;">DAMMAM</span></a>
                                                                    <span style="color: #dddddd; padding: 0 2px;">|</span>
                                                                    <a id="sig-map-alahsa" href="https://www.google.com/maps/search/?api=1&query=Emaar+Gulf+Engineering+Consulting+Office+Al-Ahsa+Branch" target="_blank" style="text-decoration: none !important; color: #888888; font-weight: 500;"><span style="color: #888888;">ALAHSA</span></a>
                                                                    <span style="color: #dddddd; padding: 0 2px;">|</span>
                                                                    <a id="sig-map-alkhobar" href="https://www.google.com/maps/search/?api=1&query=Emaar+Gulf+Consultants+Engineering" target="_blank" style="text-decoration: none !important; color: #888888; font-weight: 500;"><span style="color: #888888;">ALKHOBAR</span></a>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding: 0 25px 20px 25px; border-top: 1px solid #eeeeee;">
                                        <p id="sig-disclaimer" style="font-family: 'Inter', Helvetica, Arial, sans-serif; font-size: 9px; color: #999999; line-height: 1.4; margin: 10px 0 0 0; text-align: justify;">
                                            <strong>Disclaimer:</strong> The content of this email is confidential and intended for the recipient specified in the message only. It is strictly forbidden to share any part of this message with any third party without the written consent of the sender.
                                        </p>
                                        <p id="sig-eco" style="font-family: 'Inter', Helvetica, Arial, sans-serif; font-size: 9px; color: #4CAF50; line-height: 1.4; margin: 5px 0 0 0;">
                                            Please consider the environment before printing this email.
                                        </p>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <!-- HIDDEN TEMPLATE END -->

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        // 1. Authentication Logic
        function checkLogin() {
            const pass = document.getElementById('login-pass').value;
            const overlay = document.getElementById('login-overlay');
            const app = document.getElementById('main-app');
            const error = document.getElementById('login-error');

            if (pass === "EMAAR1352") {
                overlay.style.opacity = '0';
                overlay.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    overlay.style.display = 'none';
                    app.classList.remove('hidden');
                    app.classList.add('flex');
                }, 500);
            } else {
                error.classList.remove('hidden');
                document.getElementById('login-pass').classList.add('border-red-500');
            }
        }
        
        document.getElementById('login-pass').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') checkLogin();
        });

        // 2. Initial Data Population & Persistence
        const DEFAULT_DATA = {
            nameEn: "YOUR NAME",
            nameAr: "ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿä",
            job: "JOB TITLE | POSITION",
            branch: "Riyadh Branch",
            countryCode: "+966",
            phone: "123 456 789", 
            email: "yourmail@emaargulf.com" 
        };

        function loadState() {
            try {
                const saved = localStorage.getItem('emaar_sig_data');
                if (saved) {
                    const data = JSON.parse(saved);
                    // Safe loading: Only load if element exists
                    const setVal = (id, val) => { if(document.getElementById(id)) document.getElementById(id).value = val; };
                    
                    setVal('input-name-en', data.nameEn || DEFAULT_DATA.nameEn);
                    setVal('input-name-ar', data.nameAr || DEFAULT_DATA.nameAr);
                    setVal('input-job', data.job || DEFAULT_DATA.job);
                    setVal('input-branch', data.branch || DEFAULT_DATA.branch);
                    setVal('input-country-code', data.countryCode || DEFAULT_DATA.countryCode);
                    setVal('input-phone-number', data.phone || DEFAULT_DATA.phone);
                    setVal('input-email', data.email || DEFAULT_DATA.email);
                } else {
                    // Load defaults
                    document.getElementById('input-name-en').value = DEFAULT_DATA.nameEn;
                    document.getElementById('input-name-ar').value = DEFAULT_DATA.nameAr;
                    document.getElementById('input-job').value = DEFAULT_DATA.job;
                    document.getElementById('input-branch').value = DEFAULT_DATA.branch;
                    document.getElementById('input-country-code').value = DEFAULT_DATA.countryCode;
                    document.getElementById('input-phone-number').value = DEFAULT_DATA.phone;
                    document.getElementById('input-email').value = DEFAULT_DATA.email;
                }
            } catch (e) {
                console.error("Storage load failed, running in persistent-less mode", e);
            }
        }

        function saveState() {
            try {
                const data = {
                    nameEn: document.getElementById('input-name-en').value,
                    nameAr: document.getElementById('input-name-ar').value,
                    job: document.getElementById('input-job').value,
                    branch: document.getElementById('input-branch').value,
                    countryCode: document.getElementById('input-country-code').value,
                    phone: document.getElementById('input-phone-number').value,
                    email: document.getElementById('input-email').value
                };
                localStorage.setItem('emaar_sig_data', JSON.stringify(data));
                
                // Visual feedback
                const status = document.getElementById('save-status');
                status.style.opacity = '1';
                setTimeout(() => status.style.opacity = '0', 1000);
            } catch (e) {
                console.warn("Local storage blocked or full");
            }
        }

        function resetDefaults() {
            if(confirm("Reset all fields to default values?")) {
                try { localStorage.removeItem('emaar_sig_data'); } catch(e){}
                location.reload();
            }
        }

        window.onload = function() {
            loadState();

            // Populate Admin Inputs from DOM if safe
            const syncAdmin = (domId, inputId) => {
                const el = document.getElementById(domId);
                const input = document.getElementById(inputId);
                if(el && input) input.value = el.href;
            };

            syncAdmin('sig-wa', 'link-wa');
            syncAdmin('sig-ig', 'link-ig');
            syncAdmin('sig-fb', 'link-fb');
            syncAdmin('sig-sc', 'link-sc');
            syncAdmin('sig-li', 'link-li');
            syncAdmin('sig-x', 'link-x');
            
            syncAdmin('sig-map-riyadh', 'map-riyadh');
            syncAdmin('sig-map-dammam', 'map-dammam');
            syncAdmin('sig-map-alahsa', 'map-alahsa');
            syncAdmin('sig-map-alkhobar', 'map-alkhobar');

            updateSignature();
        }

        // 3. Real-time Intelligent Updater
        function updateSignature() {
            // Smart Input: Name (English) -> Force Uppercase
            const nameInput = document.getElementById('input-name-en');
            const nameVal = nameInput.value.toUpperCase();
            document.getElementById('sig-name-en').textContent = nameVal;
            
            // Smart Input: Job -> Force Uppercase
            const jobInput = document.getElementById('input-job');
            const jobVal = jobInput.value.toUpperCase();
            document.getElementById('sig-job').textContent = jobVal;

            // Arabic Name
            document.getElementById('sig-name-ar').textContent = document.getElementById('input-name-ar').value;
            
            // Branch Logic
            const branchSelect = document.getElementById('input-branch');
            const selectedBranch = branchSelect.value;
            document.getElementById('sig-branch').textContent = selectedBranch;

            // Footer (Disclaimer & Eco)
            const disclaimerText = document.getElementById('input-disclaimer').value;
            const ecoText = document.getElementById('input-eco').value;
            document.getElementById('sig-disclaimer').innerHTML = `<strong>Disclaimer:</strong> ${disclaimerText.replace(/^Disclaimer:\s*/i, '')}`;
            document.getElementById('sig-eco').textContent = ecoText;

            // Map Highlighting Logic
            const mapIds = {
                'Riyadh Branch': 'sig-map-riyadh',
                'Dammam Branch': 'sig-map-dammam',
                'Al Ahsa Branch': 'sig-map-alahsa',
                'Al Khobar Branch': 'sig-map-alkhobar'
            };

            Object.values(mapIds).forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.style.color = '#888888';
                    el.style.fontWeight = '500';
                    const span = el.querySelector('span');
                    if (span) span.style.color = '#888888';
                }
            });

            const activeId = mapIds[selectedBranch];
            if (activeId) {
                const activeEl = document.getElementById(activeId);
                if (activeEl) {
                    activeEl.style.color = '#f1aa27';
                    activeEl.style.fontWeight = '700';
                    const span = activeEl.querySelector('span');
                    if (span) span.style.color = '#f1aa27';
                }
            }
            
            // --- Intelligent Phone Logic ---
            const countryCode = document.getElementById('input-country-code').value;
            const phoneInput = document.getElementById('input-phone-number');
            
            // 1. Sanitize: Remove ANY non-digit char immediately
            let rawNumber = phoneInput.value.replace(/\D/g, '');
            if (phoneInput.value !== rawNumber) {
                phoneInput.value = rawNumber; // Update input value to reflect sanitization
            }
            
            // 2. Format: Chunk into groups of 3
            let formattedNumber = "";
            if (rawNumber.length > 0) {
                 formattedNumber = rawNumber.match(/.{1,3}/g).join(' ');
            }
            
            const finalDisplay = `${countryCode} ${formattedNumber}`;
            const cleanPhoneForLink = countryCode + rawNumber;

            document.getElementById('sig-phone-text').textContent = finalDisplay;
            document.getElementById('sig-phone-link').href = 'tel:' + cleanPhoneForLink;

            // WhatsApp Logic
            const waClean = cleanPhoneForLink.replace(/\+/g, '');
            const waUrl = "https://wa.me/" + waClean;
            document.getElementById('sig-wa').href = waUrl;
            
            // Sync Admin WA
            const adminWaInput = document.getElementById('link-wa');
            if (adminWaInput) adminWaInput.value = waUrl;
            
            // Smart Input: Email -> Force Lowercase & Validate
            const emailInput = document.getElementById('input-email');
            const emailVal = emailInput.value.toLowerCase();
            document.getElementById('sig-email-text').textContent = emailVal;
            document.getElementById('sig-email-link').href = 'mailto:' + emailVal;

            // Validation Visuals
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (emailVal.length > 0 && !emailRegex.test(emailVal)) {
                emailInput.classList.add('invalid-input');
                document.getElementById('email-warning').classList.remove('hidden');
            } else {
                emailInput.classList.remove('invalid-input');
                document.getElementById('email-warning').classList.add('hidden');
            }

            // Trigger Save
            saveState();
        }

        // 4. Admin Updater
        function updateAdminLinks() {
            document.getElementById('sig-ig').href = document.getElementById('link-ig').value;
            document.getElementById('sig-fb').href = document.getElementById('link-fb').value;
            document.getElementById('sig-sc').href = document.getElementById('link-sc').value;
            document.getElementById('sig-li').href = document.getElementById('link-li').value;
            document.getElementById('sig-x').href = document.getElementById('link-x').value;

            document.getElementById('sig-map-riyadh').href = document.getElementById('map-riyadh').value;
            document.getElementById('sig-map-dammam').href = document.getElementById('map-dammam').value;
            document.getElementById('sig-map-alahsa').href = document.getElementById('map-alahsa').value;
            document.getElementById('sig-map-alkhobar').href = document.getElementById('map-alkhobar').value;
        }

        // 5. Admin Unlocker
        function toggleAdmin() {
            const panel = document.getElementById('admin-panel');
            if (panel.classList.contains('hidden')) {
                const pass = prompt("Enter Senior Engineer Admin Password:");
                if (pass === "archengsafdar") {
                    panel.classList.remove('hidden');
                } else if (pass) {
                    alert("‚õî Access Denied: Incorrect Admin Credentials.");
                }
            } else {
                panel.classList.add('hidden');
            }
        }

        // 6. Copy Logic
        function copyFinalSignature() {
            const signatureNode = document.getElementById('signature-container');
            const range = document.createRange();
            range.selectNode(signatureNode);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            try {
                document.execCommand('copy');
                alert('Signature Copied! \nPaste it into Outlook (Ctrl+V).');
            } catch (err) {
                alert('Manual Copy Required. Please select the signature area and press Ctrl+C.');
            }
            window.getSelection().removeAllRanges();
        }
    </script>
</body>
</html>
